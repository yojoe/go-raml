{{- define "oauth2_client_python_aiohttp" -}}
import aiohttp

class {{.Name}}():
    def __init__(self, access_token_uri='{{.AccessTokenURI}}'):
        self.access_token_uri = access_token_uri

    async def get_access_token(self, client_id, client_secret, scopes=[], audiences=[]):
        params = {
            'grant_type': 'client_credentials',
            'client_id': client_id,
            'client_secret': client_secret
        }
        if len(scopes) > 0:
            params['scope'] = ",".join(scopes)
        if len(audiences) > 0:
            params['aud'] = ",".join(audiences)

        async with aiohttp.ClientSession() as session:
            return await session.post(self.access_token_uri, params=params)
{{- end -}}
